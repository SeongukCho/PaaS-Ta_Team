<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kopo.poly.persistance.mapper.ICtCenterMapper">

    <!-- 센터 리스트 쿼리 -->
    <select id="getCT_CenterList" resultType="CenterDTO">
        SELECT SEQ, REGION, CENTER_NAME, ADDRESS, PHONE
        FROM CT_Center
        ORDER BY SEQ;
    </select>

    <!-- 센터 등록 쿼리 -->
    <insert id="insertCT_CenterInfo" parameterType="CenterDTO">
        <selectKey keyProperty="seq" resultType="int" order="BEFORE">
            SELECT COALESCE(MAX(seq), 0) + 1 FROM CT_Center
        </selectKey>
        INSERT INTO CT_Center
        (
        SEQ, REGION, CENTER_NAME, ADDRESS, PHONE
        )
        VALUES (
        #{seq}, #{region}, #{centerName}, #{address}, #{phone}
        )
    </insert>



    <!-- 위도 경도 등록 쿼리 -->
    <insert id="insertGeocoding" parameterType="GeocodingDTO">
        INSERT INTO CT_Center (X, Y)
        VALUES (#{x}, #{y});
    </insert>


    <!-- 센터 상세보기 쿼리 -->
    <select id="getCT_CenterInfo" resultType="CenterDTO">
        SELECT SEQ, REGION, CENTER_NAME, ADDRESS, PHONE,   XADDRESS, YADDRESS

        FROM CT_Center
        WHERE seq = #{seq};

    </select>

    <!-- 센터 수정 쿼리 -->
    <update id="updateCT_CenterInfo" parameterType="CenterDTO">
        UPDATE CT_Center
        SET REGION = #{region},
            CENTER_NAME = #{centerName},
            ADDRESS = #{address},
            PHONE = #{phone}

        WHERE seq = #{seq};
    </update>

    <!-- Address가 수정이 되었다면 위도 경도 수정 쿼리 -->
    <update id="updateGeocoding" parameterType="GeocodingDTO">
        UPDATE CT_Center
        SET XADDRESS = #{xAddress},
            YADDRESS = #{yAddress}
        WHERE ADDRESS = #{address};
    </update>

    <!-- 센터 삭제 쿼리 -->
    <delete id="deleteCT_CenterInfo" parameterType="CenterDTO">
        DELETE FROM CT_Center
        WHERE SEQ = #{seq};
    </delete>
</mapper>